{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"ckanext-selfinfo","text":"<p>This extension is built to represent a basic information about the running CKAN Application accessible only to admins.</p> <p></p> <p>CKAN should be configured to be able to connect to Redis as it heavily relies on it for storage.</p> <p>On CKAN admin page <code>/ckan-admin/selfinfo</code>, admin can see such information as:</p> <ul> <li>System Information<ul> <li>System Platform</li> <li>Distribution</li> <li>Python version</li> </ul> </li> <li>RAM<ul> <li>RAM Usage in %</li> <li>RAM Usage GB</li> <li>RAM Total</li> <li>Monitor feature<ul> <li>Top 10 processes shown</li> </ul> </li> </ul> </li> <li>Disk Space<ul> <li>Path</li> <li>Disk Usage in %</li> <li>Disk Total</li> <li>Disk Free</li> </ul> </li> <li>CKAN Information<ul> <li>Basic Information</li> <li>Actions</li> <li>Auth</li> <li>Helpers</li> <li>Blueprints</li> <li>CLI Commands</li> </ul> </li> <li>GIT Information (Optional, see Config Settings section)<ul> <li>Project</li> <li>Head</li> <li>Based on</li> <li>Commit</li> <li>Remotes</li> <li>Errors info in case if cannot be shown</li> </ul> </li> <li>PIP Freeze<ul> <li>List of modules that are installed.</li> </ul> </li> <li>Python Information<ul> <li>Provides information about CKAN Core, CKAN Extensions, Python installed packages. It shows their current version and latest version.</li> </ul> </li> <li>CKAN Queues<ul> <li>Show queues and their active jobs.</li> </ul> </li> <li>Solr Schema (Optional, see Enable Solr Schema)<ul> <li>Shows CKAN Solr Schema.</li> </ul> </li> <li>Errors (Optional, see Enable Error Saving)<ul> <li>Shows latest exceptions.</li> </ul> </li> </ul> <p>Recommened to firstly visit Secure URL and Action and Unique Redis key after the installation done.</p>"},{"location":"cli/","title":"CLI","text":"<p><code>selfinfo write-selfinfo</code> - Stores Selfinfo data under unique Redis key. This data can be retrieved by selfinfo page if <code>ckan.selfinfo.additional_profiles_using_redis_keys</code> is set with the stored keys.</p> <p>Arguments:</p> <ul> <li>key - Unique Redis key. Example <code>CKAN_Additional_Selfinfo_Source</code></li> <li>label - (Optional) Label to be displayed on selfinfo page. Example <code>\"Additional Selfinfo Source\"</code>. If not provided, <code>key</code> will be used as label instead.</li> </ul> <p><code>selfinfo delete-selfinfo-redis-key</code> - Deletes Redis key if such exists specifically created for selfinfo as it adds an prefix to the unique under the hood.</p> <p>Arguments:</p> <ul> <li>key - Unique Redis key. Example <code>CKAN_Additional_Selfinfo_Source</code></li> </ul> <p><code>selfinfo write-selfinfo-duplicated-env</code> - Stores Selfinfo information in Redis under internal IP address of the Env. In order to show them, <code>ckan.selfinfo.duplicated_envs.mode</code> should be turned on in CKAN config, this replaces <code>default</code> profile with those Profile Keys.</p>"},{"location":"config_settings/","title":"Config Settings","text":"<p><code>ckan.selfinfo.redis_prefix_key</code> - This configuration is needed, when you use Redis with multiple CKAN apps. In order to have a unique key per portal, this configuration can be used. Example <code>ckan_test</code> will be used as <code>ckan_test_errors_selinfo</code>.</p> <p><code>ckan.selfinfo.page_url</code> - (Recommended to use) Used to provide alternative URL to Selfinfo Admin Page. By default it is set to <code>/ckan-admin/selfinfo</code>.</p> <p><code>ckan.selfinfo.main_action_name</code> - (Recommended to use) Used to provide an alternative name for the main action of selfinfo. By default it is set to <code>get_selfinfo</code>.</p> <p><code>ckan.selfinfo.partitions</code> - (Optional) Used for representing disk space. The value is comma separated paths. By default the value is <code>/</code>, which is usually the root.</p> <p>Example: <code>/path/to/partition /path/to/partition2 /path/to/partition3</code></p> <p><code>ckan.selfinfo.errors_limit</code> - (Optional) Limit used to specify how much errors will be stored in Redis. By default this value is <code>40</code>.</p> <p><code>ckan.selfinfo.ckan_repos_path</code> - (Optional) Path to the src folder where CKAN and CKAN Extensions stored at the environment. While provided, additional GIT Infromation will be granted. Make sure that there no other folders and files that are not related to CKAN are stored there. Example: <code>/usr/lib/ckan/default/src</code></p> <p><code>ckan.selfinfo.ckan_repos</code> - (Optional) List of CKAN Extension folders separated by space (ckanext-scheming ckanext-spatial ckanext-xloader). By default, if <code>ckan.selfinfo.ckan_repos_path</code> is provided, it will look into the directory and gather the extensions from there.</p>"},{"location":"config_settings/#note","title":"NOTE!","text":"<p>For Linux, keep in mind that the added folder in <code>ckan.selfinfo.ckan_repos_path</code> should have the same owner as the one that runs the application (e.g. if the application runs from <code>ckan</code> User in the system, then ckanext-scheming folder owner should be <code>ckan</code>), otherwise there will be an error related to ownership of the repository.</p> <p>Errors for GIT now being stored below the original Table on GIT Info tab.</p> <p><code>ckan.selfinfo.solr_schema_filename</code> - (Optional) Used to specify the filename that Solr uses for CKAN schema. Mentioned in Enable Solr Schema.</p> <p><code>ckan.selfinfo.additional_profiles_using_redis_keys</code> - (Optional) Retrieves selfinfo data on page from external sources that store selfinfo data using <code>write-selfinfo</code> cli command under unique Redis key. The stored data should be under same Redis connection as per the \"default\" profile.</p> <p>Example: <code>unique_redis_key_1 unique_redis_key_2</code></p> <p><code>ckan.selfinfo.additional_profiles_expire_time</code> - (Optional) How long the additional profiles will exists, afterwards it will be deleted automatically. Should be an positive integer number, the lifetime should be provided in seconds (e.g. 3600 is 1 hour).</p> <p><code>ckan.selfinfo.categories_list</code> - (Optional) List of categories that should only be shown on Selfinfo Page or Returned using API. Example of usage <code>ckan.selfinfo.categories_list = errors ram_usage disk_usage</code>. By default, if not set, selfinfo will show all categories available.</p> <p><code>ckan.selfinfo.duplicated_envs.mode</code> - (Optional) By enabling, removes <code>default</code> profile and replaces it by duplicated Envs mentioned in Selfinfo under Redis internal env IP key section. By default set to <code>False</code>.</p> <p><code>ckan.selfinfo.categories_list</code> - (Optional) Used in combination with ckan.selfinfo.duplicated_envs.mode to specify, which categories are going to be shared between the duplicated Envs. Mentioned in Shared categories.</p>"},{"location":"configuration/","title":"Configuration","text":"<p>Out of the box, not all information is shown, some of it should be additionally configured to appear on the Selinfo page and endpoint.</p>"},{"location":"installation/","title":"Installation","text":"<p>To install ckanext-selfinfo</p> <p>Using GIT Clone:</p> <ol> <li> <p>Activate your CKAN virtual environment, for example:</p> <p>. /usr/lib/ckan/default/bin/activate</p> </li> <li> <p>Clone the source and install it on the virtualenv</p> <p>git clone https://github.com//ckanext-selfinfo.git cd ckanext-selfinfo pip install -e .</p> </li> <li> <p>Add <code>selfinfo</code> to the <code>ckan.plugins</code> setting in your CKAN    config file (by default the config file is located at    <code>/etc/ckan/default/ckan.ini</code>).</p> </li> <li> <p>Restart CKAN. For example if you've deployed CKAN with Apache on Ubuntu:</p> <p>sudo service apache2 reload</p> </li> </ol> <p>Using Pypi:</p> <ol> <li> <p>Activate your CKAN virtual environment, for example:</p> <p>. /usr/lib/ckan/default/bin/activate</p> </li> <li> <p>pip install ckanext-selfinfo</p> </li> </ol>"},{"location":"requirements/","title":"Requirements","text":"<p>Having CKAN Core version 2.10+ and Redis configured</p>"},{"location":"configuration/categories/","title":"Categories","text":""},{"location":"configuration/categories/#categories","title":"Categories","text":"<p>Out of the box, Selfinfo will try to load all the possible information that currently available, but you can reduce those by adding <code>ckan.selfinfo.categories_list</code>, where you provide an list of categories you want to see on the page and API endpoint.</p> <p>This is really needed, when you have an instance that doesn't use UI, like CKAN Jobs worker, so for example the Blueprints are not needed, as CKAN won't provide them or Python Modules, which can be spacing consuming for big projects.</p> <p>See Config Settings for an example of this CKAN Config.</p> <p>Here are the current list of categories to choose:</p> <pre><code>ckan.selfinfo.categories_list =\n    python_modules\n    platform_info\n    ram_usage\n    disk_usage\n    git_info\n    freeze\n    errors\n    actions\n    auth_actions\n    blueprints\n    helpers\n    ckan_cli_commands\n    status_show\n    ckan_queues\n    ckan_solr_schema\n</code></pre>"},{"location":"configuration/errors/","title":"Enable Errors","text":""},{"location":"configuration/errors/#enable-errors-saving","title":"Enable Errors Saving","text":"<p>In CKAN INI file, need to add and modify few lines.</p> <p>After <code>handler_console</code> section add:</p> <pre><code>[handler_selfinfoErrorHanlder]\nclass = ckanext.selfinfo.handlers.SelfinfoErrorHandler\nlevel = ERROR\nformatter = generic\n</code></pre> <p>In <code>handlers</code> modify the <code>keys</code>, example:</p> <pre><code>[handlers]\nkeys = console, selfinfoErrorHanlder\n</code></pre> <p>In <code>logger_ckan</code> modify <code>handlers</code>, example:</p> <pre><code>[logger_ckan]\nlevel = INFO\nhandlers = console, selfinfoErrorHanlder\nqualname = ckan\npropagate = 0\n</code></pre> <p>In <code>logger_ckanext</code> modify <code>handlers</code>, example:</p> <pre><code>[logger_ckanext]\nlevel = DEBUG\nhandlers = console, selfinfoErrorHanlder\nqualname = ckanext\npropagate = 0\n</code></pre>"},{"location":"configuration/git_info/","title":"GIT Info","text":""},{"location":"configuration/git_info/#enable-git-info","title":"Enable GIT Info","text":"<p>In order to enable GIT Info you need to add the <code>ckan.selfinfo.ckan_repos_path</code>, which is the path to your folder, where all extensions stored.</p> <p>Keep in mind, that ownership for those folders should be accessible for the User that runs the CKAN APP, if not, on GIT Info tab under Repos with errors, errors will be shown regarding ownership.</p> <p>Additionally you can specify using <code>ckan.selfinfo.ckan_repos</code>, which repos you want to track from this folder, as by default it will try to read all of them.</p>"},{"location":"configuration/secure_url_and_action/","title":"Secure URL and Action","text":""},{"location":"configuration/secure_url_and_action/#setup-secure-url-and-action-name","title":"Setup secure URL and Action name","text":"<p>Out of the box, Selfinfo page registered under <code>/ckan-admin/selfinfo</code> URL, which can is only protected by Sysadmin access check.</p> <p>To add an additional layer of protection, provide an custom path that will modify the original path, so other wont know under what URL it is actually registered. This can be done by adding <code>ckan.selfinfo.page_url</code> to CKAN config, where that value is your custom URL.</p> <p></p> <p>Same goes for main Selfinfo endpoint that provides same information, but in API format. By default it uses <code>get_selfinfo</code> endpoint and to modify it using <code>ckan.selfinfo.main_action_name</code> CKAN config, where that value is the new action name.</p> <p></p>"},{"location":"configuration/solr_schema/","title":"Solr Schema","text":""},{"location":"configuration/solr_schema/#enable-solr-schema","title":"Enable Solr Schema","text":"<p>In order to enable Solr Schema you need to add <code>ckan.selfinfo.solr_schema_filename</code>, which is the filename that Solr uses for your schema. In different Solr settings this file can be named <code>managed-schema</code> or <code>schema.xml</code>, you can find which one Solr is using in your Solr Core directory -&gt; conf folder.</p> <p>If <code>ckan.selfinfo.solr_schema_filename</code> is not set, the tab will be missing.</p>"},{"location":"configuration/unique_redis_key_per_portal_instance/","title":"Unique Redis key","text":""},{"location":"configuration/unique_redis_key_per_portal_instance/#unique-redis-key-per-portalinstance","title":"Unique Redis key per portal/instance","text":"<p>By default, Selfinfo will store some of the Data like Errors or Python Modules under standard Redis keys and if you have another portal/instance connected to same Redis, they might interfere with each other, which is not what we want.</p> <p>To avoid this, you can add an unique Redis prefix key, that will allow you to separate one portal/instance from another. To do so, add <code>ckan.selfinfo.redis_prefix_key</code> config param with an unique prefix key.</p> <p>Example: adding <code>random_key</code> will store the data under <code>random_key_errors_selinfo</code>.</p> <p></p>"},{"location":"extending/overview/","title":"Extending Selfinfo","text":"<p>Selfinfo provides a different types of information about CKAN, but sometimes you need some custom information or manipulate with existing Data that Selfinfo provides.</p> <p>To extend Selfinfo, you can use CKAN hooks + template overwrite.</p>"},{"location":"extending/overview/#ckan-hooks","title":"CKAN Hooks","text":"<p>There is an interface ISelfinfo that has an method selfinfo_after_prepared, which provides you an ability to extend or modify the data before main Selfinfo action provides you.</p> <p>Example of how it might look in your <code>plugin.py</code> file:</p> <pre><code>from ckanext.selfinfo.interfaces import ISelfinfo\n\nclass MyPlugin(plugins.SingletonPlugin):\n    plugins.implements(ISelfinfo, inherit=True)\n\n    def selfinfo_after_prepared(self, data):\n        # Modifications done to data here\n\n        return data\n</code></pre>"},{"location":"extending/overview/#template-overwrite","title":"Template overwrite","text":"<p>You can add additional Tabs navigation and Tabs content by overwriting <code>additional_content_tabs.html</code> and <code>additional_navigation_tabs.html</code> templates. Those templates were specifically created to be overwritten.</p> <p>Example of how it might look for example overwriting <code>additional_navigation_tabs.html</code>:</p> <p>In your templates folder that structure should be like this:</p> <pre><code>/templates\n    /selfinfo\n        /snippets\n            /additional_navigation_tabs.html\n</code></pre> <p>Content example</p> <pre><code>&lt;a href=\"#nav-custom-{{ profile }}\" class=\"nav-link\" id=\"nav-custom-{{ profile }}-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#nav-custom-{{ profile }}\" role=\"tab\" aria-controls=\"nav-custom-{{ profile }}\" aria-selected=\"false\"&gt;Custom Tab&lt;/a&gt;\n</code></pre> <p>Why <code>snippets</code> instead of <code>{% block custom_block %}</code>, because of variables transferring after you extend an block, which are missing variables from the original template, while in overwriting snippet you can use the provided variables like <code>profile</code> and <code>data</code>.</p>"},{"location":"profiles/duplicated_env/","title":"Overview","text":""},{"location":"profiles/duplicated_env/#store-selfinfo-under-redis-internal-env-ip-key","title":"Store Selfinfo under Redis internal env IP key","text":"<p>Using <code>ckan selfinfo write-selfinfo-duplicated-env</code> cli command, you can store Selfinfo information about the CKAN APP under an internal Env IP Redis key.</p> <p>This option is needed, when your infostructure is build using Load Balancer from AWS for example, that generates duplicated Envs to distribute incoming traffic between Envs.</p> <p>By default Selfinfo stores and returns only infromation for 1 active Env that you got response from within the Client Browser or by making an request to it from another source, while having multiple duplicated Envs and opening the page, it will randomly load information from the Env that reponseded, with its current information.</p> <p>In order to see all Active duplicated Envs, you can store the information of each under an unique key using their internal IP that is assigned to them.</p> <p>To do so, you need to setup and cronjob for the Env image, from which new ENVs will be created that will run for example every 10 minutes and store its information under their IP address key.</p> <p>Then enable <code>ckan.selfinfo.duplicated_envs.mode</code> by setting it to <code>true</code> value.</p> <p>Now while opening the Selfinfo page, instead of <code>default</code> profile, there will be one or multiple profiles per each Env that is currently active.</p> <p>Additionally you can set <code>ckan.selfinfo.additional_profiles_expire_time</code> to specify how long the profiles will live. This is needed to have an old profiles to be deleted automatically after certain amount of time, when they are not being updated. Otherwise, you can manually delete an old profile from the UI.</p> <p></p> <p>Example of Cron job, running every 10 minutes:</p> <pre><code>*/10 * * * * /usr/lib/ckan/VIRTUAL_ENV/bin/ckan -c CONFIG_PATH selfinfo write-selfinfo-duplicated-env\" &gt; /dev/null 2&gt;&amp;1\n</code></pre>"},{"location":"profiles/overview/","title":"Overview","text":""},{"location":"profiles/overview/#profiles","title":"Profiles","text":"<p>By default, Selfinfo provides an infromation about current CKAN APP, which might be not enough where CKAN infostructure is split between different environments (instances).</p> <p>Due to this, <code>profiles</code> are added. This is an ability to get information about other Evnrionments on one Page. By default, main Selfinfo screen is marked under <code>default</code>, where all other profiles will have other labels or machine names.</p>"},{"location":"profiles/redis_key/","title":"Selfinfo custom Redis key","text":""},{"location":"profiles/redis_key/#store-selfinfo-under-redis-unique-key","title":"Store Selfinfo under Redis unique key","text":"<p>Using <code>ckan selfinfo write-selfinfo</code> cli command, you can store Selfinfo information about the CKAN APP under an unique Redis key, additionally adding label to it.</p> <p>The additional evironment should use same Redis connection, as the default profile in this example.</p> <p>Example of Cron job, running every 10 minutes:</p> <pre><code>*/10 * * * * /usr/lib/ckan/VIRTUAL_ENV/bin/ckan -c CONFIG_PATH selfinfo write-selfinfo UNIQUE_REDIS_KEY \"CUSTOM LABEL\" &gt; /dev/null 2&gt;&amp;1\n</code></pre> <p>Then you need to add this custom key to Selnfinfo config param <code>ckan.selfinfo.additional_profiles_using_redis_keys</code>, after reload the additional profile will be displayed.</p> <p></p>"},{"location":"profiles/shared_categories/","title":"Shared Categories","text":""},{"location":"profiles/shared_categories/#shared-caregories-between-envs","title":"Shared Caregories between Envs","text":"<p>While completing the steps from previous section, you'll be able to see new profiles per each duplicated Env.</p> <p>But because each Env stores its data, the storage can be increased <code>x</code> times per each duplicated Env, this is mostly related to Errors storage or Python Packages. Also Errors are going to be updated only after the cron job is completed (e.g. each 10 minutes for example).</p> <p>We can improve this by providing <code>ckan.selfinfo.duplicated_envs.shared_categories</code>, which are categories that will be shared between all duplicated Envs on fly.</p> <p>As an example I will take <code>errors</code>, as they are being stored in Redis and usually you want to have an access to them as soon as possible.</p> <p>Adding <code>errors</code> to <code>ckan.selfinfo.duplicated_envs.shared_categories</code>:</p> <ul> <li>While running the <code>ckan selfinfo write-selfinfo-duplicated-env</code> cronjob, it wont save the <code>errors</code> key in the Data, which free the storage for Redis.</li> <li>While opening the Selfinfo page, it will load the Env profiles and will attach the <code>errors</code> key to them on fly from the global <code>errors</code> key instead (e.g. wont store them per Env profile).</li> <li>Those Errors will be provided in real time on each page load, no matter what Env profile you are looking at, meaning that if one of Envs encountered an Error, it will be present on all profiles.</li> </ul> <pre><code>ckan.selfinfo.duplicated_envs.shared_categories =\n    errors\n</code></pre>"},{"location":"selftools/config_settings/","title":"Config Settings","text":"<p><code>ckan.selftools.opetations_pwd</code> - (Recommended) Provides an additional security layer for operations like update/delete/create for the Categoires.</p> <p><code>ckan.selftools.operations_limit</code> - (optional) Sets an limit to most of the operations like query/update. By default the limit is set to <code>100</code>.</p> <p><code>ckan.selftools.categories</code> - (optional) You can specify the categories you want to see on Selftools, for example you can remove DB category or leave only Config category. By default if not set, Selftools will show all possbile Categories. Current list looks this <code>solr db redis config model</code>.</p> <p><code>ckan.selftools.tools_blacklist</code> - This is needed, when you don't want to remove for example DB Category, but want to disable the Update tools for security reasons, this config params allows you do to this. Here is an example of how it will look like if you want to disable DB Update and Redis Delete tools. In CKAN config we need to provide it like this <code>db.db_update redis.redis_delete</code>.</p> <p><code>ckan.selftools.config_blacklist</code> - (optional) In this configuration, you can add CKAN config that you don't want to expose while doing the query as an additional security layer, for example DB conection or Tokens. By default there already an predefined list of CKAN configuations that won't be shown like <code>sqlalchemy.url</code> and more. To provide an additional list set it like this <code>ckan.site_url ckan.site_id</code> and so on.</p> <p><code>ckan.selftools.model_fields_blacklist</code> - (optional) This setting gives an ability to hide the actual value for specific Model that returs in DB results while doing Query operation. For example if you want to make sure that User email or Package name are not exposed in the results after DB query, you can achieve this by adding list of fields per Model that you want to hide like this <code>Package.name User.email</code>, where first part is the Model name and the second one is the field for this model. Default hidden fields are <code>User.password User.apikey</code>.</p> <p><code>ckan.selftools.model_key_ecryption</code> - (optional) This settings is used for in Model category to ecrypt the Export data to secure it.</p>"},{"location":"selftools/configuration/","title":"Confiruation","text":"<p>Make sure to re-install Selfinfo extension mentioned in Installation step.</p> <p>To enable Selftools, you'll need to add <code>selftools</code> plugin to plugins list, but make sure that it is added before <code>selfinfo</code> plugin.</p> <p>Recommended step is to provide an password that will be required each time you want to do an Update/Delete operations using CKAN param <code>ckan.selftools.opetations_pwd</code> and this password will be required by the Action as an additional security layer. This configuration param is by default added to Config blacklist, so won't be exposed.</p> <p>You can check other CKAN config params that can be configured for Selftools and its Categories here.</p>"},{"location":"selftools/extending_selftools/","title":"Extending Selftools","text":""},{"location":"selftools/extending_selftools/#extending-db-models-list","title":"Extending DB Models list","text":"<p>To extend Selftools DB Models list, you can use CKAN hooks.</p>"},{"location":"selftools/extending_selftools/#ckan-hooks","title":"CKAN Hooks","text":"<p>There is an interface <code>ISelftools</code> that has an method <code>selftools_db_models</code>, which provides you an ability to extend or modify Models list that will appear in DB Category.</p> <p>Example of how it might look in your <code>plugin.py</code> file:</p> <pre><code>from ckanext.selftools.interfaces import ISelftools\n\nclass MyPlugin(plugins.SingletonPlugin):\n    plugins.implements(ISelftools, inherit=True)\n\n    def selftools_db_models(self, models_list):\n        # Modifications done to models_list here\n\n        return models_list\n</code></pre>"},{"location":"selftools/overview/","title":"Overview","text":""},{"location":"selftools/overview/#selftools","title":"Selftools","text":"<p>This plugin suggested to be an addition to Selfinfo tools, but considered to be moved to a separate plugin, due to difference in main idea and purpouse of Selfinfo.</p> <p>Unlike Selfinfo, where you retrieve information about CKAN setup, Selftools provides an actual data that stored for CKAN and be able to do manipulations with it like create/update/delete operations.</p> <p>Currently there few categories that comes out of the box and in future, there might be more categories and the existing tools will get more and more functionality overtime.</p> <p>Categories:</p> <ul> <li>SOLR<ul> <li>Query</li> <li>Index</li> <li>Delete</li> </ul> </li> <li>DB<ul> <li>Query</li> <li>Update</li> </ul> </li> <li>Redis<ul> <li>Query</li> <li>Update/Create</li> <li>Delete</li> </ul> </li> <li>Config<ul> <li>Query</li> </ul> </li> <li>Model<ul> <li>Export</li> <li>Import</li> </ul> </li> <li>Datastore<ul> <li>Data</li> </ul> </li> </ul> <p>Those categories can be used an many cases when quick fix is required on remote Environments or for investigation in combination with Selfinfo Errors category.</p> <p>Each category has its own separate page, where all of their functionality is shown and described.</p>"},{"location":"selftools/categories/config/","title":"Config","text":""},{"location":"selftools/categories/config/#query","title":"Query","text":"<p>Provides an ability to check CKAN config params.</p> <p>There is a functionality that allows to add CKAN Config params to blacklist, in order not to expose any critical infromation. Please check Config Settings -&gt; <code>ckan.selftools.config_blacklist</code> param for more details.</p> <p></p>"},{"location":"selftools/categories/datastore/","title":"Datastore Category","text":"<p>Datastore Category provides comprehensive tools for managing CKAN Datastore tables directly from the UI. It allows you to browse, inspect, filter, and delete datastore tables with advanced features for identifying orphaned tables (tables without corresponding CKAN resources).</p> <p></p> <p>All modification operations are password-protected to prevent accidental data loss.</p>"},{"location":"selftools/categories/datastore/#query","title":"Query","text":"<p>Browse and search through all datastore tables in your PostgreSQL database.</p> <p>Features:</p> <ul> <li>Search: Filter tables by name using pattern matching</li> <li>Orphaned tables detection: Checkbox to show only tables without corresponding CKAN resources (highlighted in yellow)</li> <li>Batch processing: Efficiently handles large numbers of tables (processes in batches of 1000)</li> <li>Table information: Displays table name, record count, and resource link (if exists)</li> <li>Two-column layout: Tables list on the left, detailed data view on the right</li> </ul> <p>Orphaned tables are tables that exist in the datastore but don't have a corresponding resource in CKAN. This typically happens when: - Resources were deleted from CKAN but datastore tables weren't cleaned up - Import processes failed partially - Manual database operations created tables outside of CKAN</p>"},{"location":"selftools/categories/datastore/#table-data","title":"Table Data","text":"<p>View and filter data from any datastore table with advanced filtering capabilities.</p> <p>Features:</p> <ul> <li>Column metadata: View all column names with PostgreSQL data types in an expandable accordion</li> <li>Custom limit: Set record limit from 1 to 100,000 (default: 1000)</li> <li>Column filtering: Select a column from dropdown and filter by specific value</li> <li>Interactive table: Powered by DataTable.js with pagination, search, and sorting</li> <li>CSV export: Export filtered results to CSV file</li> <li>Resource linking: Direct link to CKAN resource page (if table is linked to a resource)</li> </ul>"},{"location":"selftools/categories/db/","title":"DB","text":"<p>DB Category give you an ability to retrieve data from DB and update rows in it.</p> <p>The Query and Update tools are based on predefined list of CKAN Models to select from.</p> <p>There is a functionality that allows to extend the Models list and add your own Models to the List. You can find more details here.</p> <p>Also you can hide the actual values for specific fields that shown in the results, to make sure that they are not exposed. This can be done by adding <code>ckan.selftools.model_fields_blacklist</code>, for more details look here.</p>"},{"location":"selftools/categories/db/#query","title":"Query","text":"<p>Provides an ability to search in DB using registered Models in CKAN.</p> <p></p>"},{"location":"selftools/categories/db/#update","title":"Update","text":"<p>Provides an ability to update data within DB.</p> <p></p>"},{"location":"selftools/categories/model/","title":"Model","text":"<p>Model category allows to Export/Import data based on CKAN Models, bypassing the original validation for the schemas to replicate data as it is on other envs for testing, replicating broken data from remotes instances, updating data, migrate data without using DB dumps.</p> <p>There currently predefined Models list that can be chosen from, but this list can be extended, please read on how to do so here. This is highly recommend.</p> <p>Both Export and Import can be additionally secured by setting the <code>ckan.selftools.opetations_pwd</code>, this will allow to additionally protect the actions from external/internal usage. You can find the setting for it here</p>"},{"location":"selftools/categories/model/#export","title":"Export","text":"<p>Provides and ability to Export CKAN data.</p> <p></p> <p>Currently the exported file is compressed using <code>gzip</code>.</p>"},{"location":"selftools/categories/model/#encryption","title":"Encryption","text":"<p>You also can secure the exported data by encrypting it, while providng an key for encryption using  <code>ckan.selftools.model_key_ecryption</code> config setting. This encrypt using <code>cryptography.fernet</code> and use the provided key to decrypt it while Importing stage to secure the exported data.</p> <p>To generate an key you can run this in you console under activated Virtualenv and installed Selfinfo extension, then copy the generated key and set it in the mentioned above CKAN config setting. <pre><code>from cryptography.fernet import Fernet\nFernet.generate_key()\n</code></pre></p>"},{"location":"selftools/categories/model/#how-it-works","title":"How it works?","text":"<p>While you chose an Model to export, beside the Model data, it will also gather all of its relationships registered for this Model and store this information in <code>JSON</code> format. Also there is an ability to provides custom relationships to other Models using <code>Custom Relationships</code> fields.</p> <p>For example lets use <code>Package</code> model and it covers all features.</p> <p>While exporting <code>Package</code> model, it returns all rows that in the DB for this Model and data of the <code>Models it has relationships to</code>, like <code>PackageExtra</code> or <code>PackageTag</code>, but while those relationships are registered, there other relationships that are not like <code>Group</code> and <code>User</code>. So in order to attach them as well, you need to specify <code>Custom Relationships</code>. The Custom Relationship will look like this, where the Local specifies local column of the Model (e.g. Package) and Remote the column of the remote Model (e.g. Group). After adding those, you be able to see them in the Preview list.</p> <p></p> <p>Need to keep in mind, that the Custom Relationships doesn't related only to current chosed model, but can be specified other Models that can appear in the chain of relationships for the current model as it checks for those Relationships for each Row individually.</p> <p>Also, while exoprting for example 100 Packages that related to only 1 Organization, the Organization will appear only once in the JSON list, so there won't be duplicates, which can increase loading time while importing and size of the exported file.</p>"},{"location":"selftools/categories/model/#import","title":"Import","text":"<p>Provides an ability import the exported file to re-create the data on the internal/external portals.</p> <p>You should be able to provide both compressed or compressed and encrypted files.</p> <p>Keep in mind, that the Export adds all possible Relationships, even those that are not specified in the default Models list. So if you have issues while Importing or having an custom Models that are not present in the list, try to add them according to this solution, as Import won't be aware of those and can throws errors while importing process.</p> <p>Known issues:</p> <ul> <li>While import Users, their passwords will be changed. This is due to User Model logic while assigning password to the model.</li> </ul> <p></p>"},{"location":"selftools/categories/redis/","title":"Redis","text":""},{"location":"selftools/categories/redis/#query","title":"Query","text":"<p>Provides an ability to serach through Redis using keys.</p> <p></p>"},{"location":"selftools/categories/redis/#updatecreate","title":"Update/Create","text":"<p>Provides an ability to update/create Redis key/value.</p> <p></p>"},{"location":"selftools/categories/redis/#delete","title":"Delete","text":"<p>Provides an ability to delete key from Redis if exists.</p> <p></p>"},{"location":"selftools/categories/solr/","title":"Solr","text":""},{"location":"selftools/categories/solr/#query","title":"Query","text":"<p>Provides an ability to make pure Solr queries and check on how the Dataset is being indexed in Solr.</p> <p></p>"},{"location":"selftools/categories/solr/#index","title":"Index","text":"<p>Provides an ability index/re-index Datasets from UI. It can 1 Dataset or multiple Datasets.</p> <p></p>"},{"location":"selftools/categories/solr/#delete","title":"Delete","text":"<p>Provides an to delete Dataset from index.</p> <p></p>"},{"location":"selftracking/categories/","title":"Categories","text":"<p>You can add your own custom categories to Selftracking section alongside Page View and API View or modify the exisitng categories.</p>"},{"location":"selftracking/categories/#ckan-hook","title":"CKAN Hook","text":"<p>There is an interface <code>ISelftracking</code> that has an method <code>selftracking_categories</code>, which provides you an ability to extend or modify categories list.</p> <p>Example of how it might look in your <code>plugin.py</code> file:</p> <pre><code>from ckanext.selftracking.interfaces import ISelftracking\n\nclass MyPlugin(plugins.SingletonPlugin):\n    plugins.implements(ISelftracking, inherit=True)\n\n    def selftracking_categories(self, models_list):\n        # Modifications done to categories here\n        # You can register any category you need, it shouldn't be only Track types, but an custom dashboards\n        # Example of structure\n        new_category = {\n            \"key\": \"resource_download\",\n            \"label\": \"Resource Downloads\",\n            \"snippet\": \"CUSTOM_PATH_TO_SNIPPET\", # Example /YOUR_EXTENSION/snippets/selftracking_resource_download.html\n        }\n\n        categories.append(new_category)\n\n        return categories\n</code></pre> <p>Within your snippet you'll need to prepare an variable or logic that will return expected data. Here is an example of variable using helper function, but you can construct anything you would like, even an full functional dashboard based of your needs: <pre><code>{% set resource_download_data = h.selftracking_get_view_data(\"resource download\") %}\n\n&lt;div class=\"p-3 mt-4\"&gt;\n    &lt;div class=\"table-responsive\"&gt;\n        &lt;div class=\"d-flex justify-content-between mb-3 align-items-center\"&gt;\n          &lt;button class=\"btn btn-dark\" onclick=\"copyTableJsonToClipboard('selftracking-api-views-path')\"&gt;\n            Copy as JSON\n          &lt;/button&gt;\n        &lt;/div&gt;\n        &lt;table id=\"selftracking-resource-download-path\" class=\"table table-striped table-bordered table-hover\" data-module=\"selftracking-views-table\" data-module-target=\"selftracking-api-views-path\"&gt;\n            &lt;thead class=\"table-light\"&gt;\n              &lt;tr&gt;\n                  &lt;th scope=\"col\"&gt;{{ _('Path') }}&lt;/th&gt;\n                  &lt;th scope=\"col\"&gt;{{ _('Views') }}&lt;/th&gt;\n              &lt;/tr&gt;\n            &lt;/thead&gt;\n            &lt;tbody&gt;\n              {% for row in api_view_data %}\n                &lt;tr&gt;\n                    &lt;td&gt;{{ row[0] }}&lt;/td&gt;\n                    &lt;td&gt;{{ row[1] }}&lt;/td&gt;\n                &lt;/tr&gt;\n              {% endfor %}\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre></p>"},{"location":"selftracking/config_settings/","title":"Config Settings","text":"<p><code>ckan.selftracking.redis_prefix</code> - (Recommended) Adds prefix to Redis Selftracking key, so it will be unique. For example <code>my_project_name</code>, as an result it will store tracks under <code>my_project_name_selftracking_tracks</code> key.</p> <p><code>ckan.selftracking.categories</code> - (optional) Manages that list of categories shown on the Selftracking page. For example you don't need <code>Page Views</code>, so the categories will be <code>main api_view</code>.</p> <p><code>ckan.selftracking.redis_batch_size</code> - (optional) Sets the amount of tracks that will be stored in DB per 1 call of <code>selftracking_store_tracks</code> action. By default its <code>300</code>.</p> <p><code>ckan.selftracking.type_color.</code> - (optional) Sets an color for specific track type for all graphics. For example if we want <code>page view</code> type to be <code>rgba(0, 128, 0, 0.7)</code> the config will look like <code>ckan.selftracking.type_color.page_view = rgba(0, 128, 0, 0.7)</code>, the name of the type should use underscore instead of space. HEX colors can be used as well. By default the color is being constracted based on the track type string.</p>"},{"location":"selftracking/configuration/","title":"Configuration","text":"<p>Make sure to re-install Selfinfo extension mentioned in Installation step.</p> <p>To enable <code>selftracking</code>:</p> <ol> <li> <p>Add <code>selftracking</code> plugin before <code>selfinfo</code> plugin at <code>ckan.plugins</code>, so it will inherit its templates.</p> </li> <li> <p>Initialize <code>selftracking</code> tables in DB:      <pre><code>ckan -c CKAN_CONFIG_PATH db upgrade -p selftracking\n</code></pre></p> </li> <li> <p>Restart CKAN. For example if you've deployed CKAN with Apache on Ubuntu:      <pre><code>sudo service apache2 reload\n</code></pre></p> </li> <li> <p>The data won't autocatically will be saved in your DB, so in order to make it appear from Redis in your DB, you'll either need to figure out an way to call <code>selftracking_store_tracks</code> that will store tracks in DB or use Cron job for this (calls the action every 10 mins):      <pre><code>*/10 * * * * /usr/lib/ckan/VIRTUAL_ENV/bin/ckan -c CONFIG_PATH selftracking store-tracking &gt; /dev/null 2&gt;&amp;1\n</code></pre>      CKAN jobs worker is not used for this, as it can be stuck in the queue, which we don't want to happen if there big Resources that should be indexed to the Datastore.</p> </li> </ol>"},{"location":"selftracking/custom_tracks/","title":"Custom Tracks","text":"<p>There few options of how you can add your own track types, here two examples:</p> <ol> <li> <p>Using <code>utils</code> function <code>selftracking_add_track_to_redis</code>, which accepts <code>dict</code> like this:     <pre><code>data = {\n    \"path\": PATH,\n    \"user\": USER_ID,\n    \"type\": TRACK_TYPE,\n    \"track_time\": datetime.utcnow().timestamp(),\n}\n\nselftracking_add_track_to_redis(data)\n</code></pre> This will store your custom track at Redis and will be stored in DB once <code>selftracking_store_tracks</code> action is called.</p> </li> <li> <p>Using javascript that will file on item click (e.g. links like Resource Download):     <pre><code>&lt;a class=\"\" href=\"{{ PATH }}\" data-module=\"selftracking-track-click\" data-module-activity=\"{{ TRACK_TYPE }}\" data-module-path=\"{{ PATH }}\"&gt;\n    &lt;i class=\"fas fa-scroll\" aria-hidden=\"true\"&gt;&lt;/i&gt;\n&lt;/a&gt;\n</code></pre></p> <p><code>user</code> and <code>track_time</code> will added in the action automatically.</p> <p>It will send an ajax call to CKAN that will store you custom track.</p> </li> </ol>"},{"location":"selftracking/overview/","title":"Overview","text":""},{"location":"selftracking/overview/#selftracking","title":"Selftracking","text":"<p>This CKAN extension provides a lightweight tracking system for monitoring how users interact with your data portal. It captures three main types of events:</p> <p>Page views \u2013 Track visits to datasets, resources, organizations, or any other portal pages.</p> <p>API usage \u2013 Record calls made to CKAN API endpoints to better understand programmatic access.</p> <p>Custom tracks \u2013 Log specific user actions, such as resource downloads or other interactions you want to monitor. Check custom events section for more details.</p> <p>The tracking is designed to run efficiently without adding overhead to CKAN\u2019s normal operations. Collected data can be used for analytics, reporting, or integration with external monitoring tools, helping administrators understand portal usage patterns and user behavior.</p> <p>Out of the box only Page View and API View categories are available without modifications.</p>"},{"location":"selftracking/overview/#how-it-works","title":"How it works?","text":"<p>While visiting page, in order not to interact with the DB it stores the action in Redis special list. After finalizing the Configuration step 4, it then from Redis should appear in your DB. Same goes for custom registered track types mentioned in Custom Tracks.</p>"}]}